<% content_for :title, "Headache Logs for #{@user.username}" %>
<% content_for :navbar, "Doctor's view" %>

<div class="print:hidden join join-vertical w-full mb-4">
  <%= render "shared/filter_form" %>
</div>

<div class="flex-none lg:flex mb-4 gap-4">
  <article class="prose mb-8 max-w-none grow">
    <h1>Cluster Headache Report for <%= @user.username %></h1>
    <blockquote>Generated by <%= link_to "clusterheadachetracker.com", "https://clusterheadachetracker.com" %> on <%= Date.today %></blockquote>
  </article>

  <div class="print:hidden mb-4 lg:mb-0">
    <button onclick="window.print()" class="btn btn-primary gap-2">
      <%= heroicon "printer", variant: "mini" %>
      Print
    </button>
  </div>

  <div class="print:hidden">
    <button onclick="print_instructions.showModal()" class="btn btn-primary gap-2">
      <%= heroicon "arrow-down-on-square", variant: "mini" %>
      Save as PDF
    </button>
  </div>
</div>

<dialog id="print_instructions" class="modal print:hidden">
  <div class="modal-box">
    <h3 class="font-bold text-lg mb-4">Save as PDF Instructions</h3>
    <div class="space-y-2">
      <p>1. Click the "Print Now" button below</p>
      <p>2. Select "Print to PDF" or "Print to File" as your printer</p>
      <p>3. Click "Print" to save as PDF</p>
    </div>
    <div class="modal-action">
      <button class="btn btn-primary" onclick="window.print()">Print Now</button>
      <form method="dialog">
        <button class="btn">Close</button>
      </form>
    </div>
  </div>
  <form method="dialog" class="modal-backdrop">
    <button>close</button>
  </form>
</dialog>

<div class="print:max-w-none print:w-full">
  <%= render "headache_logs/stats", headache_logs: @headache_logs %>
</div>

<article class="prose mb-2 print:max-w-none">
  <h1>Analysis</h1>
</article>

<div class="print:max-w-none print:w-full">
  <%= render partial: 'shared/charts', locals: { headache_logs: @headache_logs, chart_data: @chart_data } %>
</div>

<article class="prose mb-2 print:max-w-none print:mt-8">
  <h1>Detailed Log Entries</h1>
</article>

<%= turbo_stream_from @user, "headache_logs" %>
<%= render "headache_logs/table", headache_logs: @headache_logs, hide_actions: true %>

<article class="prose max-w-none">
</article>
