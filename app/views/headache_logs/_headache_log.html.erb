<%= content_tag :div, id: dom_id(headache_log), class: "card bg-base-100 shadow-md hover:shadow-lg transition-all duration-200" do %>
  <div class="card-body flex flex-col h-full p-3 sm:p-4">
    <%# Header Section with Time and Intensity %>
    <div class="flex flex-row justify-between items-start gap-3">
      <div class="flex-1">
        <h3 class="text-sm sm:text-base font-semibold text-base-content">
          <%= headache_log.start_time.strftime("%b %d, %Y Â· %I:%M %p") %>
        </h3>
        <div class="flex items-center gap-2 mt-1">
          <% if headache_log.end_time %>
            <span class="text-xs text-base-content/60">
              <%= heroicon "clock", variant: "mini", class: "w-3 h-3 inline-block" %>
              <%= distance_of_time_in_words(headache_log.end_time, headache_log.start_time) %>
            </span>
          <% else %>
            <span class="badge badge-error badge-xs animate-pulse">Ongoing</span>
          <% end %>
        </div>
      </div>

      <%# Intensity Indicator %>
      <div class="text-center">
        <div class="relative">
          <%
            # Calculate smooth color interpolation
            intensity_color = if headache_log.intensity <= 3
              'hsl(142, 71%, 45%)' # Green
            elsif headache_log.intensity <= 6
              # Interpolate from green to yellow
              ratio = (headache_log.intensity - 3) / 3.0
              hue = (142 - (ratio * (142 - 45))).round
              saturation = (71 + (ratio * (93 - 71))).round
              lightness = (45 + (ratio * (47 - 45))).round
              "hsl(#{hue}, #{saturation}%, #{lightness}%)"
            else
              # Interpolate from yellow to red
              ratio = (headache_log.intensity - 6) / 4.0
              hue = (45 * (1 - ratio)).round
              saturation = (93 - (ratio * (93 - 84))).round
              lightness = (47 + (ratio * (60 - 47))).round
              "hsl(#{hue}, #{saturation}%, #{lightness}%)"
            end
          %>
          <div class="radial-progress shadow-sm"
               style="--value:<%= (headache_log.intensity.to_f / 10 * 100).round %>; --size:2.25rem;
                      color: <%= intensity_color %>;">
            <span class="text-base font-bold"><%= headache_log.intensity %></span>
          </div>
          <div class="absolute -inset-1 rounded-full opacity-30 blur-sm"
               style="background-color: <%= intensity_color %>;"></div>
        </div>
      </div>
    </div>

    <%# Compact Details Section %>
    <div class="mt-2 space-y-2">
      <% if headache_log.medication.present? %>
        <div class="bg-primary/5 rounded-lg p-2">
          <div class="flex items-start gap-2">
            <%= heroicon "beaker", variant: "mini", class: "w-4 h-4 text-primary flex-shrink-0 mt-0.5" %>
            <div class="flex flex-wrap gap-1">
              <% headache_log.medication.split(",").map(&:strip).each do |med| %>
                <span class="badge badge-primary badge-sm"><%= med %></span>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>

      <% if headache_log.triggers.present? %>
        <div class="bg-secondary/5 rounded-lg p-2">
          <div class="flex items-start gap-2">
            <%= heroicon "bolt", variant: "mini", class: "w-4 h-4 text-secondary flex-shrink-0 mt-0.5" %>
            <div class="flex flex-wrap gap-1">
              <% headache_log.triggers.split(",").map(&:strip).each do |trigger| %>
                <span class="badge badge-secondary badge-sm"><%= trigger %></span>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>

      <% if headache_log.notes.present? %>
        <div class="bg-base-200 rounded-lg p-2">
          <div class="flex items-start gap-2">
            <%= heroicon "document-text", variant: "mini", class: "w-4 h-4 text-base-content/60 flex-shrink-0 mt-0.5" %>
            <p class="text-xs text-base-content/70 line-clamp-2"><%= headache_log.notes %></p>
          </div>
        </div>
      <% end %>
    </div>

    <%# This empty div will push the actions to the bottom when content is short %>
    <div class="flex-grow"></div>

    <%# Actions Section %>
    <div class="flex justify-end gap-1 mt-3 pt-2 border-t border-base-200/50">
      <% unless local_assigns[:hide_actions] %>
        <%= link_to edit_headache_log_path(headache_log),
            class: "btn btn-ghost btn-xs",
            data: { turbo_frame: "_top" } do %>
          <%= heroicon "pencil-square", variant: "mini", class: "w-3 h-3" %>
          Edit
        <% end %>

        <%= button_to headache_log_path(headache_log),
            method: :delete,
            class: "btn btn-ghost btn-xs text-error",
            data: {
              turbo_confirm: "Are you sure you want to delete this headache log?"
            } do %>
          <%= heroicon "trash", variant: "mini", class: "w-3 h-3" %>
          Delete
        <% end %>
      <% end %>
    </div>
  </div>
<% end %>
