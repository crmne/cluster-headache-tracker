<!DOCTYPE html>
<html>
  <head>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
    <style>
      body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; }
      .container { max-width: 600px; margin: 0 auto; padding: 20px; }
      .header { background-color: #570df8; color: white; padding: 20px; text-align: center; }
      .content { padding: 20px; background-color: #f5f5f5; }
      .feedback-summary { background: white; padding: 15px; margin: 10px 0; border-radius: 8px; }
      .rating { margin: 10px 0; }
      .star { color: #ffd700; }
      .response-box { background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 5px; }
      .badge { display: inline-block; padding: 5px 10px; margin: 2px; border-radius: 15px; font-size: 12px; }
      .badge-primary { background-color: #570df8; color: white; }
      .badge-secondary { background-color: #f000b8; color: white; }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>New Feedback Received</h1>
      </div>

      <div class="content">
        <div class="feedback-summary">
          <h2>User Information</h2>
          <p><strong>Username:</strong> <%= @feedback_survey.user.username %></p>
          <p><strong>Submitted:</strong> <%= @feedback_survey.created_at.strftime("%B %d, %Y at %I:%M %p %Z") %></p>
          <p><strong>Usage Duration:</strong> <%= @feedback_survey.usage_duration %></p>
        </div>

        <div class="feedback-summary">
          <h2>Ratings</h2>
          <div class="rating">
            <strong>Ease of Use:</strong>
            <% @feedback_survey.ease_of_use.times do %>
              <span class="star">★</span>
            <% end %>
            <% (5 - @feedback_survey.ease_of_use).times do %>
              <span style="color: #ccc;">★</span>
            <% end %>
            (<%= @feedback_survey.ease_of_use %>/5)
          </div>
          <div class="rating">
            <strong>Recommendation Likelihood:</strong>
            <% @feedback_survey.recommendation_likelihood.times do %>
              <span class="star">★</span>
            <% end %>
            <% (5 - @feedback_survey.recommendation_likelihood).times do %>
              <span style="color: #ccc;">★</span>
            <% end %>
            (<%= @feedback_survey.recommendation_likelihood %>/5)
          </div>
        </div>

        <% if @feedback_survey.versions.present? && @feedback_survey.versions.any? %>
          <div class="feedback-summary">
            <h3>Platforms Used</h3>
            <% @feedback_survey.versions.each do |version| %>
              <span class="badge badge-primary"><%= version %></span>
            <% end %>
          </div>
        <% end %>

        <% if @feedback_survey.most_useful_features.present? && @feedback_survey.most_useful_features.any? %>
          <div class="feedback-summary">
            <h3>Most Useful Features</h3>
            <% @feedback_survey.most_useful_features.each do |feature| %>
              <span class="badge badge-secondary"><%= feature %></span>
            <% end %>
          </div>
        <% end %>

        <% if @feedback_survey.impact.present? %>
          <div class="feedback-summary">
            <h3>Impact on Headache Management</h3>
            <div class="response-box">
              <%= simple_format(@feedback_survey.impact) %>
            </div>
          </div>
        <% end %>

        <% if @feedback_survey.change_suggestion.present? %>
          <div class="feedback-summary">
            <h3>One Thing to Change</h3>
            <div class="response-box" style="border-left: 3px solid #ff9800;">
              <%= simple_format(@feedback_survey.change_suggestion) %>
            </div>
          </div>
        <% end %>

        <% if @feedback_survey.additional_features.present? %>
          <div class="feedback-summary">
            <h3>Additional Features Requested</h3>
            <div class="response-box" style="border-left: 3px solid #00bcd4;">
              <%= simple_format(@feedback_survey.additional_features) %>
            </div>
          </div>
        <% end %>

        <div class="feedback-summary">
          <h3>Summary Stats</h3>
          <p><strong>Total Feedback Responses:</strong> <%= @total_feedback %></p>
          <p><strong>Average Ease of Use:</strong> <%= @average_ease_rating || "N/A" %>/5</p>
          <p><strong>Average Recommendation:</strong> <%= @average_recommendation || "N/A" %>/5</p>
        </div>

        <p style="margin-top: 20px;">
          <%= link_to "View Full Feedback", admin_feedback_survey_url(@feedback_survey), style: "background-color: #570df8; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px; display: inline-block;" %>
        </p>
      </div>
    </div>
  </body>
</html>
